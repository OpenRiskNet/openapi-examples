# EADB data set

## Source

This data on endocrine disruptors comes from the FDA.

TODO: describe the origin of this dataset in more detail.

TODO: briefly describe the contents of this dataset

## Content

The original data is provided as an Excel spreadsheet that has been uploaded into
[Google Docs](https://drive.google.com/file/d/1J_VFEI5enk_YTqHY-ejdjWspv59XMaXc/view?ths=true).

It's also present as a [Google Sheet](https://docs.google.com/spreadsheets/d/1f5J4JUNRINohz9kJXy7g9UT2wxJA0fCWg_40PJkWE8E/edit#gid=1121551817) that also contains additional information on other workbooks.

Thomas Exner did some initial analysis of the data that can found in this [Google Sheet](https://docs.google.com/spreadsheets/d/1kg8-6HEn-ikSloNtWTX8O8Aanzi_-h7Cg-H4NwhO_HQ/edit#gid=1933108353).

The data from the Excel sheet was exported to a tab separated text format file [eadb.tsv](eadb.tsv).
This tsv file provides the input for the work described here. 

## Processing

The fist step was to convert the data to JSON so that it can be semantically annotated.
This is done with the [parser.groovy](parser.groovy) script that is described [here](../README.md).

**NOTE:** Run all commands from the data_examples directory.

The [flat-config.groovy](flat-config.groovy) configuration just specifies the data types on the fields that are not text types and generates a flat datastructure in JSON that is the equivalent of the original TSV file. It is now more parsable but does not contain any useful organisational  structure. It can be used like this:
```
groovy parser.groovy -c eadb/flat-config.groovy -m parse eadb/eadb.tsv > eadb/eadb-flat.json
```
A sample record looks like this:

```
  {
    "CAS_NUMBER": "50-28-2",
    "ID": 1,
    "COMPOUND_CODE": 1,
    "COMPOUND_NAME": "estradiol",
    "FMLA": "C18H24O2",
    "MOLECULAR_WEIGHT": 272.38,
    "KOWLOGP": 3.74,
    "SMILES": "C[C@]12CC[C@H]3[C@@H](CCc4cc(O)ccc34)[C@@H]1CC[C@@H]2O",
    "PUBLICATION_DATE": 2002,
    "SOURCE_URL": "http://iccvam.niehs.nih.gov/methods/endocrine/end_bckgnd.htm",
    "ASSAY_CLASS_NAME": "Binding",
    "ASSAY_NAME": "In vitro ER binding assays using MCF-7 Cells",
    "SPECIES_STRAIN": "Human",
    "ENDPOINT_NAME": "logRBA",
    "ENDPOINT_VALUE": 2
  }
```
The full file is here: [eadb-flat.json](eadb-flat.json).

If instead you use the [hierarchical-1-config.groovy](hierarchical-1-config.groovy) configuration using a command like this:
```
groovy parser.groovy -c eadb/hierarchical-1-config.groovy -m parse eadb/eadb.tsv > eadb/eadb-hierarchical-1.json
```
then more structured output is generated with a single record looking like this:

```
 {
    "ID": 1,
    "ENDPOINT_NAME": "logRBA",
    "ENDPOINT_VALUE": 2,
    "Compound": {
      "CAS_NUMBER": "50-28-2",
      "COMPOUND_CODE": 1,
      "COMPOUND_NAME": "estradiol",
      "FMLA": "C18H24O2",
      "MOLECULAR_WEIGHT": 272.38,
      "KOWLOGP": 3.74,
      "SMILES": "C[C@]12CC[C@H]3[C@@H](CCc4cc(O)ccc34)[C@@H]1CC[C@@H]2O"
    },
    "Citation": {
      "PUBLICATION_DATE": 2002,
      "SOURCE_URL": "http://iccvam.niehs.nih.gov/methods/endocrine/end_bckgnd.htm"
    },
    "Assay": {
      "ASSAY_CLASS_NAME": "Binding",
      "ASSAY_NAME": "In vitro ER binding assays using MCF-7 Cells",
      "SPECIES_STRAIN": "Human"
    }
  }
```
Comparing this to the configuration 


The full file is here: [eadb-hierarchical-1.json](eadb-hierarchical-1.json).

This is achieved by assigning a `category` attribute to each of the fields. Fields with a certain category are grouped into sub-objects of that type (e.g. Compound, Citation and Assay). Those without a category are treated as belonging to the top level element which corresponds to the readout.

This structure can be thought of as each row in the TSV file defining a single readout record, and that readout is respect to a particular Compound, Citation and Assay. The Compounds, Citations and Assays are repeated throughout the file as multiple readouts correspond to the same compound etc. e.g. this is a many-to-one relationship that has been de-normalised.

Other hierarchies can be generated by using different configuration files. No one hierarchy is 'correct', but the one generated by the [hierarchical-1-config.groovy](hierarchical-1-config.groovy) config seems reasonable.

## Annotation using Douglas Connect ChemID Convert tool

TODO: provide brief details of this service

OpenAPI JSON annotations of the flat and hierarhical-1 representations were generated by this tool:  

```
{
  "openapi": "3.0.1",
  "info": {
    "title": "EADB data set",
    "description": "Simple REST API exposing the EADB data set.",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "https://raw.githubusercontent.com/OpenRiskNet/openapi-examples/master/data_examples/eadb"
    }
  ],
  "paths": {
    "/eadb-flat.json": {
      "get": {
        "summary": "Returns the denoramlised, flat dataset.",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Denoramlised, flat dataset.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "CAS_NUMBER": {
                        "type": "string",
                        "description": "Cas number"
                      },
                      "ID": {
                        "type": "string",
                        "description": "ID"
                      },
                      "COMPOUND_CODE": {
                        "type": "string",
                        "description": "Compound code"
                      },
                      "COMPOUND_NAME": {
                        "type": "string",
                        "description": "Compound name"
                      },
                      "FMLA": {
                        "type": "string",
                        "description": "Fmla"
                      },
                      "MOLECULAR_WEIGHT": {
                        "type": "number",
                        "description": "Molecular weight"
                      },
                      "KOWLOGP": {
                        "type": "string",
                        "description": "Kowlogp"
                      },
                      "SMILES": {
                        "type": "string",
                        "description": "Smiles"
                      },
                      "PUBLICATION_DATE": {
                        "type": "string",
                        "description": "Publication date"
                      },
                      "SOURCE_URL": {
                        "type": "string",
                        "format": "url",
                        "description": "Source url"
                      },
                      "ASSAY_CLASS_NAME": {
                        "type": "string",
                        "description": "Assay class name"
                      },
                      "ASSAY_NAME": {
                        "type": "string",
                        "description": "Assay name"
                      },
                      "SPECIES_STRAIN": {
                        "type": "string",
                        "description": "Species strain"
                      },
                      "ENDPOINT_NAME": {
                        "type": "string",
                        "description": "Endpoint name"
                      },
                      "ENDPOINT_VALUE": {
                        "type": "number",
                        "description": "Endpoint value"
                      }
                    }
                  }
                }
              }
            }
          },
          "default": {
            "description": "Unexpected error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "/eadb-hierarchical-1.json": {
      "get": {
        "summary": "Returns the denoramlised, hierarchical dataset.",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Denoramlised, hierarchical dataset.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "ID": {
                        "type": "string",
                        "description": "ID"
                      },
                      "ENDPOINT_NAME": {
                        "type": "string",
                        "description": "Endpoint name"
                      },
                      "ENDPOINT_VALUE": {
                        "type": "number",
                        "description": "Endpoint value"
                      },
                      "Compound": {
                        "CAS_NUMBER": {
                          "type": "string",
                          "description": "Cas number"
                        },
                        "COMPOUND_CODE": {
                          "type": "string",
                          "description": "Compound code"
                        },
                        "COMPOUND_NAME": {
                          "type": "string",
                          "description": "Compound name"
                        },
                        "FMLA": {
                          "type": "string",
                          "description": "Fmla"
                        },
                        "MOLECULAR_WEIGHT": {
                          "type": "number",
                          "description": "Molecular weight"
                        },
                        "KOWLOGP": {
                          "type": "string",
                          "description": "Kowlogp"
                        },
                        "SMILES": {
                          "type": "string",
                          "description": "Smiles"
                        }
                      },
                      "Citation": {
                        "PUBLICATION_DATE": {
                          "type": "string",
                          "description": "Publication date"
                        },
                        "SOURCE_URL": {
                          "type": "string",
                          "format": "url",
                          "description": "Source url"
                        }
                      },
                      "Assay": {
                        "ASSAY_CLASS_NAME": {
                          "type": "string",
                          "description": "Assay class name"
                        },
                        "ASSAY_NAME": {
                          "type": "string",
                          "description": "Assay name"
                        },
                        "SPECIES_STRAIN": {
                          "type": "string",
                          "description": "Species strain"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "default": {
            "description": "Unexpected error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    }
  }
}
```

These are somewhat similar to the cnfiguration files used to parse the TSV data, though with more boiler plate related to the REST aspects. It nicely handles the hierarchical aspects. The flat version does not in any way infer the hierarchical that is implicit in the data and seen in the hierarchical version.

Ideally the flat data (e.g. TSV data) could be annotated in a manner that allowed the hierarchy to be inferred. e.g. in a way analagous to the [hierarchical-1 parser configuration](hierarchical-1-config.groovy).


## Next Steps

1. Investigate how to annotate this dataset (Daniel)
2. Investigate pivoting the dataset (Tim) 
