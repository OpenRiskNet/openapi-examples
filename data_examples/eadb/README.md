# EDB data set

## Source

TODO: describe the origin of this dataset

TODO: briefly describe the contents of thsi dataset

## Content

The original data is provided as an Excel spreadsheet that has been uploaded into
[Google Docs](https://drive.google.com/file/d/1J_VFEI5enk_YTqHY-ejdjWspv59XMaXc/view?ths=true).

It's also present as a [Google Sheet](https://docs.google.com/spreadsheets/d/1f5J4JUNRINohz9kJXy7g9UT2wxJA0fCWg_40PJkWE8E/edit#gid=1121551817) that also contains additional information on other workbooks.

Thomas Exner did some initial analysis of the data that can found in this [Google Sheet](https://docs.google.com/spreadsheets/d/1kg8-6HEn-ikSloNtWTX8O8Aanzi_-h7Cg-H4NwhO_HQ/edit#gid=1933108353).

The data from the Excel sheet was exported to a tab separated text format file [](eadb.tsv). 

## Processing

The fist step was to convert the data to JSON so that it can be semantically annotated.
This is done with the [](parser.groovy) script. Run like this:

```
groovy parser.groovy -c <config-file> -m parse <tsv-file>
```
For all the options run this:
```
$ groovy parser.groovy -h
usage: parser.groovy -m <mode> -c <config> [-s <separator>] -[h] file
 -c,--config <config>         Configuration file
 -h,--help                    Show usage information
 -m,--mode <mode>             Main method to run
 -s,--separator <separator>   Separator in data file (default tab)
```

The -c argument is used to specify a configuration file that determines how the data is handled (the config file is loaded by the Groovy [ConfigSlurper class](http://docs.groovy-lang.org/latest/html/gapi/groovy/util/ConfigSlurper.html)).

The [](flat-config.groovy) configuration just specifies the data types on the fields that are not text types and generates a flat datastructure in JSON that is the equivalent of the original TSV file. It is now more parseable but does not contain any useful organisational  structure. It can be used like this:
```
groovy parser.groovy -c flat-config.groovy -m parse eadb.tsv > eadb-flat-config.json
```
A sample record looks like this:

```
  {
    "CAS_NUMBER": "50-28-2",
    "ID": 1,
    "COMPOUND_CODE": 1,
    "COMPOUND_NAME": "estradiol",
    "FMLA": "C18H24O2",
    "MOLECULAR_WEIGHT": 272.38,
    "KOWLOGP": 3.74,
    "SMILES": "C[C@]12CC[C@H]3[C@@H](CCc4cc(O)ccc34)[C@@H]1CC[C@@H]2O",
    "PUBLICATION_DATE": 2002,
    "SOURCE_URL": "http://iccvam.niehs.nih.gov/methods/endocrine/end_bckgnd.htm",
    "ASSAY_CLASS_NAME": "Binding",
    "ASSAY_NAME": "In vitro ER binding assays using MCF-7 Cells",
    "SPECIES_STRAIN": "Human",
    "ENDPOINT_NAME": "logRBA",
    "ENDPOINT_VALUE": 2
  }
```

If instead you use the [](hierarchical-1-config.groovy) configuration using a command like this:
```
groovy parser.groovy -c hierarchical-1-config.groovy -m parse eadb.tsv > eadb-hierarchical-1.json
```
then more structured output is generated with a single record looking like this:

```
 {
    "ID": 1,
    "ENDPOINT_NAME": "logRBA",
    "ENDPOINT_VALUE": 2,
    "Compound": {
      "CAS_NUMBER": "50-28-2",
      "COMPOUND_CODE": 1,
      "COMPOUND_NAME": "estradiol",
      "FMLA": "C18H24O2",
      "MOLECULAR_WEIGHT": 272.38,
      "KOWLOGP": 3.74,
      "SMILES": "C[C@]12CC[C@H]3[C@@H](CCc4cc(O)ccc34)[C@@H]1CC[C@@H]2O"
    },
    "Citation": {
      "PUBLICATION_DATE": 2002,
      "SOURCE_URL": "http://iccvam.niehs.nih.gov/methods/endocrine/end_bckgnd.htm"
    },
    "Assay": {
      "ASSAY_CLASS_NAME": "Binding",
      "ASSAY_NAME": "In vitro ER binding assays using MCF-7 Cells",
      "SPECIES_STRAIN": "Human"
    }
  }
```
The full file is here: [](eadb-hierarchical-1.json).

This is achieved by assigning a `category` attribute to each of the fields. Fields with a certain category are grouped into sub-objects of that type (e.g. Compound, Citation and Assay). Those without a category are treated as belonging to the top level element which corresponds to the readout.

This structure can be thought of as each row in the TSV file defining a single readout record, and that readout is respect to a particular Compound, Citation and Assay. The Compounds, Citations and Assays are repeated throughout the file as multiple readouts correspond to the same compound etc. e.g. this is a many-to-one relationship that has been de-nomalised.

Other hierarchies can be generated by using different configuration files. No one hierarchy is 'correct', but the one generated by the [](hierarchical-1-config.groovy) config seems reasonable.
